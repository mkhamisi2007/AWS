| Policy Template                  | کاربرد ساده                       |
| -------------------------------- | --------------------------------- |
| **AWSLambdaBasicExecutionRole**  | نوشتن لاگ در CloudWatch           |
| **S3ReadPolicy**                 | فقط خواندن از S3                  |
| **S3CrudPolicy**                 | خواندن + نوشتن + حذف در S3        |
| **DynamoDBReadPolicy**           | فقط خواندن از DynamoDB            |
| **DynamoDBCrudPolicy**           | CRUD کامل روی DynamoDB            |
| **SQSPollerPolicy**              | خواندن و حذف پیام از SQS          |
| **SNSPublishMessagePolicy**      | ارسال پیام به SNS                 |
| **SESPolicy**                    | ارسال ایمیل با SES                |
| **VPCAccessPolicy**              | دسترسی Lambda به VPC              |
| **CloudWatchPutMetricPolicy**    | ارسال Metric سفارشی به CloudWatch |
| **EventBridgePutEventsPolicy**   | ارسال Event به EventBridge        |
| **StepFunctionsExecutionPolicy** | اجرای State Machine               |

---------------------------------------------------
MyFunction:
  Type: AWS::Serverless::Function
  Properties:
    Runtime: python3.11
    Handler: app.lambda_handler
    CodeUri: src/
    Policies:
      - S3ReadPolicy: #----> S3
          BucketName: my-bucket-name
-------------------------------------------------
MyFunction:
  Type: AWS::Serverless::Function
  Properties:
    Runtime: python3.11
    Handler: app.lambda_handler
    CodeUri: src/
    Policies:
      - DynamoDBCrudPolicy: #----> DynamoDB
          TableName: MyTable
-------------------------------------------------
MyFunction:
  Type: AWS::Serverless::Function
  Properties:
    Runtime: python3.11
    Handler: app.lambda_handler
    CodeUri: src/
    Policies:
      - SQSPollerPolicy: #----> SQS
          QueueName: MyQueue
-------------------------------------------------
AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31
Description: SAM demo - S3 Read, DynamoDB CRUD, SQS Poller (Policy Templates)

Globals:
  Function:
    Timeout: 10
    MemorySize: 128
    Runtime: python3.11

Resources:

  # ----------- Shared Resources -----------
  DemoBucket:
    Type: AWS::S3::Bucket

  DemoTable:
    Type: AWS::DynamoDB::Table
    Properties:
      BillingMode: PAY_PER_REQUEST
      AttributeDefinitions:
        - AttributeName: id
          AttributeType: S
      KeySchema:
        - AttributeName: id
          KeyType: HASH

  DemoQueue:
    Type: AWS::SQS::Queue

  # ----------- 1) Lambda: Read from S3 -----------
  LambdaS3Reader:
    Type: AWS::Serverless::Function
    Properties:
      CodeUri: src/s3reader/
      Handler: app.lambda_handler
      Policies:
        - S3ReadPolicy:
            BucketName: !Ref DemoBucket
      Environment:
        Variables:
          BUCKET_NAME: !Ref DemoBucket

  # ----------- 2) Lambda: CRUD on DynamoDB -----------
  LambdaDynamoCrud:
    Type: AWS::Serverless::Function
    Properties:
      CodeUri: src/dynamocrud/
      Handler: app.lambda_handler
      Policies:
        - DynamoDBCrudPolicy:
            TableName: !Ref DemoTable
      Environment:
        Variables:
          TABLE_NAME: !Ref DemoTable

  # ----------- 3) Lambda: Poll SQS -----------
  LambdaSqsPoller:
    Type: AWS::Serverless::Function
    Properties:
      CodeUri: src/sqspoller/
      Handler: app.lambda_handler
      Policies:
        - SQSPollerPolicy:
            QueueName: !GetAtt DemoQueue.QueueName
      Environment:
        Variables:
          QUEUE_URL: !Ref DemoQueue

      # (اختیاری ولی رایج) اگر می‌خواهی Lambda با Event Source Mapping اتوماتیک پیام‌ها را بگیرد:
      Events:
        SQSTrigger:
          Type: SQS
          Properties:
            Queue: !GetAtt DemoQueue.Arn
            BatchSize: 10

Outputs:
  BucketName:
    Description: Demo S3 bucket name
    Value: !Ref DemoBucket

  TableName:
    Description: Demo DynamoDB table name
    Value: !Ref DemoTable

  QueueUrl:
    Description: Demo SQS queue URL
    Value: !Ref DemoQueue

  S3ReaderFunctionName:
    Description: Lambda function that can read from S3
    Value: !Ref LambdaS3Reader

  DynamoCrudFunctionName:
    Description: Lambda function that can CRUD DynamoDB
    Value: !Ref LambdaDynamoCrud

  SqsPollerFunctionName:
    Description: Lambda function that polls SQS
    Value: !Ref LambdaSqsPoller



